<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Accueil ‚Äî Analyse de l'√âtat 4001</title>
  <link rel="stylesheet" href="style.css" />

  <!-- üåç Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-sA+e2Qj+G0F3bQWZtYtF0ljL7ZxFD8TKzGT6Jf0OQH0="
    crossorigin=""
  />

  <style>
    .section-index {
      background: #fafdff;
      border-radius: 12px;
      padding: 28px 22px 18px 22px;
      margin: 32px 0 0 0;
      box-shadow: 0 2px 16px #1764c608;
    }
    .section-index h3 {
      margin-top: 0;
      color: #1764c6;
      font-size: 1.25em;
    }
    .btn-center {
      text-align: right;
      margin-top: 13px;
    }
    .button-link {
      display: inline-block;
      padding: 13px 26px;
      background: #1764c6;
      color: #fff !important;
      text-decoration: none;
      border-radius: 6px;
      font-size: 1.04em;
      font-weight: 600;
      box-shadow: 0 2px 8px #0001;
      transition: background 0.19s, transform 0.08s;
      border: none;
      cursor: pointer;
    }
    .button-link:hover, .button-link:focus {
      background: #0b3d91;
      transform: translateY(-2px) scale(1.04);
      color: #fff;
    }
    @media (max-width:700px) {
      .section-index {
        padding: 20px 8px 10px 8px;
      }
      .btn-center {
        text-align: center;
      }
    }
    #map {
      height: 600px;
      border-radius: 12px;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <h1>Analyse de l'√âtat 4001</h1>
      <nav>
        <a href="index.html">Accueil</a>
        <a href="histoire.html">Histoire</a>
        <a href="construction.html">Construction</a>
        <a href="observatoire.html">Observatoire</a>
        <a href="limites.html">Outil limit√©</a>
        <a href="depasse.html">Outil d√©pass√©</a>
        <a href="ssmsi.html">SSMSI</a>
        <a href="table-index.html">Table des index</a>
      </nav>
    </div>
  </header>
  <main class="container">
    <h2>Bienvenue</h2>
    <p>Ce site pr√©sente une analyse acad√©mique de la base de donn√©es ‚Äú√âtat 4001‚Äù portant sur les faits de d√©linquance. Explorez chaque rubrique ci-dessous :</p>

    <!-- üó∫Ô∏è Carte interactive -->
    <section class="section-index">
      <h3>Carte interactive ‚Äî Taux de vols (pour 1 000 habitants, 2023)</h3>
      <div id="map"></div>
    </section>

    <section class="section-index">
      <h3>Histoire de la base de donn√©es</h3>
      <p>D√©crivez ici les origines, les √©volutions et les contextes de cr√©ation de la base √âtat 4001. Exemples : date de cr√©ation, cadre institutionnel, grands jalons.</p>
      <div class="btn-center">
        <a href="histoire.html" class="button-link">Acc√©der √† la rubrique</a>
      </div>
    </section>

    <section class="section-index">
      <h3>Construction de la base</h3>
      <p>D√©crivez la structure de la base : quelles sont les variables, la m√©thode de collecte, les sources de donn√©es, la cha√Æne de traitement, les formats utilis√©s, etc.</p>
      <div class="btn-center">
        <a href="construction.html" class="button-link">Acc√©der √† la rubrique</a>
      </div>
    </section>

    <section class="section-index">
      <h3>Observatoire & utilisation</h3>
      <p>Expliquez l‚Äôimplication de l‚ÄôObservatoire de la d√©linquance et de la r√©ponse p√©nale, la fa√ßon dont il utilise l‚Äô√âtat 4001, l‚Äôint√©r√™t statistique ou scientifique.</p>
      <div class="btn-center">
        <a href="observatoire.html" class="button-link">Acc√©der √† la rubrique</a>
      </div>
    </section>

    <section class="section-index">
      <h3>√âtat 4001 : un outil limit√©</h3>
      <p>Pr√©sentez les limites connues de la base (biais, manque ou retard de donn√©es, limitations techniques ou de couverture, etc.).</p>
      <div class="btn-center">
        <a href="limites.html" class="button-link">Acc√©der √† la rubrique</a>
      </div>
    </section>

    <section class="section-index">
      <h3>√âtat 4001 : un outil d√©pass√©</h3>
      <p>Argumentez sur l‚Äôobsolescence √©ventuelle de la base : √©volutions technologiques manqu√©es, besoins non couverts, absence d‚Äôinterop√©rabilit√©.</p>
      <div class="btn-center">
        <a href="depasse.html" class="button-link">Acc√©der √† la rubrique</a>
      </div>
    </section>

    <section class="section-index">
      <h3>L‚Äô√âtat 4001 et le SSMSI</h3>
      <p>D√©crivez le lien avec le Service Statistique Minist√©riel de la S√©curit√© Int√©rieure (SSMSI), compl√©mentarit√©, √©volution, transformation ou perspective de fusion, etc.</p>
      <div class="btn-center">
        <a href="ssmsi.html" class="button-link">Acc√©der √† la rubrique</a>
      </div>
    </section>

    <section class="section-index">
      <h3>Table des indices</h3>
      <p>Retrouvez la table compl√®te des index et libell√©s d'infractions utilis√©s dans ‚Äú√âtat 4001‚Äù.</p>
      <div class="btn-center">
        <a href="table-index.html" class="button-link">Acc√©der au tableau</a>
      </div>
    </section>
  </main>
  <footer class="site-footer">
    <div class="container">
      <p>&copy; 2025 ‚Äî Projet acad√©mique. √âquipe de rendu.</p>
    </div>
  </footer>

  <!-- üåç Leaflet JS + PapaParse -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-o9N1j7kBntEPEu8j3f5ykZ1wI8zFDoXJgIk1JtGmNNM="
    crossorigin=""
  ></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    // Initialisation de la carte Leaflet
    var map = L.map('map').setView([46.8, 2.5], 6);

    L.tileLayer('https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {
      maxZoom: 12,
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    // Charger les d√©partements
    fetch('https://france-geojson.gregoiredavid.fr/repo/departements.geojson')
      .then(res => res.json())
      .then(geojson => {
        Papa.parse('donnee-dep-data.gouv-2024-geographie2025-produit-le2025-06-04.csv', {
          download: true,
          header: true,
          complete: function(results) {
            const data = results.data;
            const vols = {};

            // Filtrer les donn√©es : uniquement 2023 et indicateurs contenant "vol"
            data.forEach(row => {
              const annee = parseInt(row.annee);
              const indic = (row.indicateur || '').toLowerCase();
              if (annee === 2023 && indic.includes('vol')) {
                const code = row['Code_departement'].padStart(2, '0');
                const taux = parseFloat(row.taux_pour_mille.replace(',', '.'));
                vols[code] = taux;
              }
            });

            // D√©finir la couleur selon le taux
            function getColor(d) {
              return d > 20 ? '#800026' :
                     d > 15 ? '#BD0026' :
                     d > 10 ? '#E31A1C' :
                     d > 5  ? '#FC4E2A' :
                     d > 2  ? '#FD8D3C' :
                     d > 1  ? '#FEB24C' :
                     d > 0  ? '#FED976' :
                              '#FFEDA0';
            }

            function style(feature) {
              const code = feature.properties.code;
              const taux = vols[code] || 0;
              return {
                fillColor: getColor(taux),
                weight: 1,
                opacity: 1,
                color: 'white',
                dashArray: '3',
                fillOpacity: 0.75
              };
            }

            // Ajouter les d√©partements √† la carte
            L.geoJson(geojson, {
              style: style,
              onEachFeature: function(feature, layer) {
                const code = feature.properties.code;
                const taux = vols[code] ? vols[code].toFixed(2) : 'N/A';
                layer.bindPopup(
                  `<strong>${feature.properties.nom}</strong><br>Taux de vols (2023) : ${taux} / 1 000 hab.`
                );
              }
            }).addTo(map);
          }
        });
      });
  </script>
</body>
</html>
